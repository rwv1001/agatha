

<h1>Listing people</h1>
<%   %>
<% form_tag :action => :table_search  %>

<%  possibe_search_controllers = session[:possible_search_controllers_strings]%>
<%= select_tag "existing_tables", options_for_select(possibe_search_controllers, session[:search_controller_index]) %>
<% possible_filters = session[:search_controller].possible_filter_names %>
<% default_filter_index =  possible_filters.length -1  %>
<%= select_tag "possible_filters", options_for_select(possible_filters, default_filter_index)  %>
<input type="button" class ="check" value="Add Filter">
<div id ="current_filters">
  <% for filter in session[:search_controller].current_filters %>
     <p> <%= text_field_tag filter.tag, filter.current_filter_string %> <label>filter.full_name</label>  </p>
  <% end %> <!--- for filter in session[:search_controller].current_filters -->
</div>



<%  end %> <!--- form_tag :action => :table_search -->

 <%  form_tag :action => :list_update do %>
 <div>
 <%= select_tag "field_selector", options_for_select(session[:search_controller].possible_field_strings, session[:search_controller_index]) %>

 </div>
 <div>
  <table  id="search_results" >
    
    <tr class="column-header">
        <% for field_index in session[:search_controller].current_field_indices %>
    <th > <%= session[:search_controller].available_fields[field_index].qualifier %></th>
    <%  end  %>
    <th class="select-cell"></th>
    </tr>
    <tr class="column-header">
  <% for field_index in session[:search_controller].current_field_indices %>
    <th  > <%= session[:search_controller].available_fields[field_index].header %></th>
    <%  end  %>
    <th class="select-cell">Select</th>
    </tr>
    <% my_table = GroupMember.find(:first, :conditions => "people.second_name like '%Verr%'" , :include => :person) %>
    <% for row in @table %>
      <tr class="<%= cycle('row-even', 'row-odd') %>">
        <%  for field_index in session[:search_controller].current_field_indices %>
          <td> <%= eval(session[:search_controller].available_fields[field_index].eval) %> </td>

        <% end %>
         <td class ="select-cell"> <input type="checkbox" name ="row_in_list[]" class="check" value= <%=row.id.to_s %>  ></td>
      </tr>

    <% end %>
<tr class="column-header">
 <% for field_index in session[:search_controller].current_field_indices %>
    <th  > <%= session[:search_controller].available_fields[field_index].header %></th>
    <%  end  %>group_list
    <th class="select-cell"> Select </th>
    </tr>
    <tr class="column-header">
        <% for field_index in session[:search_controller].current_field_indices %>
    <th > <%= session[:search_controller].available_fields[field_index].qualifier %></th>
    <%  end  %>
    <th class="select-cell"></th>
    </tr>
  </table>
</div>
<div>

<input type="button" class ="check" value="Select All"
onClick="$$('#search_results input.check').each(function(box){box.checked=true})">
<input type="button" class ="check"  value="Deselect All"
onClick="$$('#search_results input.check').each(function(box){box.checked=false})">
<input type="button" class ="check" value="Invert Selection"
onClick="$$('#search_results input.check').each(function(box){box.checked=!box.checked})">


</div>
<div id ="list_buttons">
<%= select_tag "existing_lists", options_for_select((Group.new).group_list_strings, 0) %>

 <%= submit_tag "Add selected to list", :class => 'list_button', :id => 'add_to_list_button' %>
<%= submit_tag "Remove selected from list", :class => 'list_button'  %>
<%= submit_tag "Delete list",  :confirm => 'Are you sure you want to delete this list?' , :class => 'list_button'%>


</div>
<div id ="list_buttons2"><%= submit_tag "Add to new list" , :id => 'new_list_button'%>
 <%= text_field_tag :new_list_name %>
</div>


<% end  %>


<%  form_tag :action => :list_update do %>
  <div>
<table  id="name_selection" >
  <tr>
    <th>Title</th>
    <th>1st name</th>
    <th>2nd name</th>
    <th>Postnom.</th>
    <th>Entry year</th>
    <th></th>
     <th></th>
    <th>Select</th>
  </tr>

<% for person in @people %>
  <tr>
    <td><%=link_to (h person.title), person, :popup => true  %></td>
    <td><%=link_to (h person.first_name), person, :popup => true  %></td>
    <td><%=link_to (h person.second_name), person, :popup => true  %></td>
    <td><%=link_to (h person.postnomials), person, :popup => true  %></td>
    <td><%=h person.entry_year %></td>    
    <td><%=link_to "Show", person, :id => person.id, :popup => true %></td> 
    <td><%= link_to 'Delete', person, :confirm => 'Are you sure?', :method => :delete %></td>
   <td> <input type="checkbox" name ="row_in_list[]" class="check" value= <%=person.id.to_s %>  ></td>
    <!--  <td> <%= check_box_tag "row_in_list[]", person.id, false %> </td> -->
     <!--  <td><%= check_box_tag "row_in_list[]", person.id, false %></td> -->
  </tr>
<% end %>
<tr>
  <th>Title</th>
    <th>1st name</th>
    <th>2nd name</th>
    <th>Postnom.</th>
    <th>Entry year</th>
    <th></th>
     <th></th>
    <th>Select</th>
  </tr>

</table>
</div>
<div>

<input type="button" class ="check" value="Select All"
onClick="$$('#name_selection input.check').each(function(box){box.checked=true})">
<input type="button" class ="check"  value="Deselect All"
onClick="$$('#name_selection input.check').each(function(box){box.checked=false})">
<input type="button" class ="check" value="Invert Selection"
onClick="$$('#name_selection input.check').each(function(box){box.checked=!box.checked})">

  
</div>
<div id ="group_buttons">
<%= select_tag "group_list", options_for_select((Group.new).group_list_strings, 0) %>

 <%= submit_tag "Add selected to list", :class => 'list_button', :id => 'add_to_group_button' %>
<%= submit_tag "Remove selected from list", :class => 'list_button'  %>
<%= submit_tag "Delete list",  :confirm => 'Are you sure you want to delete this list?' , :class => 'list_button'%>


</div>
<div id ="group_buttons2"><%= submit_tag "Add to new list" , :id => 'new_group_button'%>
 <%= text_field_tag :new_group_name %>
</div>
<% end  %>



  <div > <% form_tag :action => :search do %>
  <p > <%= text_field_tag :searchstr2nd, session[:searchstr2nd] %><label class="search_field">Second Name Filter</label>  e.g. <code>H%r</code> gives second names beginning with H and ending with r</p>
  <p > <%= text_field_tag :searchstr1st, session[:searchstr1st] %><label class="search_field">First Name Filter</label> e.g. <code>%([a-e]|[t-z])_ </code>  gives first names with penultimate letter in range a to e or in the range t to z</p>
 <p > <%= text_field_tag :searchstrYear, session[:searchstrYear] %><label class="search_field">Entry year Filter</label> e.g. <code>2007</code> gives entry year 2007</p>
<%= select_tag "sort[]", options_for_select(Person::SortString, Person::SortString[session[:sortOption]]) %>
 
<p> <%= submit_tag "Search" %></p>
<% end %></div>

<div > <% form_tag :action => :import_csv do %>
<p> <%= submit_tag "Import CSV" %></p>
<% end %></div>

<div > <% form_tag :action => :import_courses do %>
<p> <%= submit_tag "Import Courses CSV" %></p>
<% end %></div>

<p><%= link_to "Add a new person", {:action => :new } %></p>
<p><%= link_to "Back to main menu", {:controller => "index"  } %> </p>
<br />


  
</div>

